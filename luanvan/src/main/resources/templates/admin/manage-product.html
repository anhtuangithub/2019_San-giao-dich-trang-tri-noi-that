<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{admin/parts/layout}">
<head>
<title>Sản phẩm</title>
<style>
	.custom-navtabs-color{
		color:blue;
	}
	.custom-navtabs-color:hover{
		color:#878787;
	}
</style>


<section layout:fragment="css">
    <link rel="stylesheet"
	th:href="@{/css/fileinput.css}">
	<link rel="stylesheet"
	th:href="@{/css/theme.css}">
</section>
</head>
<body>
	<section layout:fragment="content">

		<div style="padding: 20px;">
			<h2>Quản lý sản phẩm</h2>
		</div>
		
		<div class="content " ng-controller="ProductController">
		
			<div class="animated fadeIn">
				<div class="row">
					<div class="col-md-12">
						<div class="card">
							<div class="card-header">
								<strong class="card-title">Danh sách sản phẩm</strong>
							</div>
							<div class="card-body">
								<table id="bootstrap-data-table-export"
									class="table table-bordered table-hover text-center"
									dt-options="dtOptions" dt-columns="dtColumns" datatable="ng"
									>
									<thead class="thead-light">
										<tr>
											<th>Sản phẩm</th>
											<th>Hàng còn</th>
											<th>Giá Gốc</th>
											<th>Giá Bán</th>
											<th>Danh mục</th>
											<th>Ngày đăng</th>
											<th>Trạng thái</th>
											<th>
												<button class="btn btn-addProduct" ng-click="modal('add')">Thêm
													sản phẩm mới</button>
											</th>
										</tr>
									</thead>
									<tbody>
									<!-- 	|filter:{product.categorys: filterReverse } -->
										<tr ng-repeat="product in listproduct "  id="tr_{{ product.id }}">
											<td>{{product.name}}</td>
											<td>{{product.inventory_number}}</td>
											<td>{{product.price| currency: "":0}} đ</td>
											<td>{{product.price_new| currency: "":0}} đ</td>
											<td>{{product.categorys.name}}</td>
											<td>{{product.created_at| date: "dd-MM-yyyy 'giờ' h:mma ":'UTC' }}</td>
											<td ng-if="product.status == 1"><span class="fa fa-unlock"></span></td>
											<td ng-if="product.status == 0"><span class="fa fa-lock" style="color:#bd2130"></span></td>
											<td>
												<button class="btn-none-background btn-detail" ng-click="frmCreateEdit_Show(product.id)" >
													<span class="fa fa-eye-slash table-click-icon"></span>
												</button>
												<button class="btn-none-background" ng-click="modal('edit',product.id)" >
													<span class="fa fa-pencil table-click-icon"></span>
												</button>
												<button class="btn-none-background" ng-click="modalImg(product.id)" >
													<span class="fa fa-picture-o table-click-icon"></span>
												</button>
												<button class="btn-none-background" ng-click="deleteProduct(product.id, product.name)" ng-if="product.status == 0">
													<span class="fa fa-trash-o table-click-icon"></span>
												</button>
												
											</td>
										</tr>

									</tbody>
								</table>
							</div>
						</div>
					</div>


				</div>
			</div>
			<!-- .animated -->


			<!-- Modal Add and Edit Product -->

			<div class="modal fade" id="myModal">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">

						<!-- Modal Header -->
						<div class="modal-header">
							<h4 class="modal-title">{{ frmTitle }}</h4>
							<button type="button" class="close" data-dismiss="modal">×</button>

						</div>

						<!-- Modal body -->
						<div class="modal-body">
							<div class="col-md-12">
								<ul class="nav nav-tabs">
								    <li class="nav-item">
								    	<a class="nav-link active" data-toggle="tab" href="#home">Danh mục</a>
								    </li>
								    <li class="nav-item" >
								    	<a class="nav-link" data-toggle="tab" href="#menu1">Thông tin</a>
								    </li>
								    <li class="nav-item" >
								    	<a class="nav-link" data-toggle="tab" href="#menu4">Đơn giá</a>
								    </li>
								    <li class="nav-item" >
								    	<a class="nav-link" data-toggle="tab" href="#menu2">Ảnh</a>
								    </li>
								    <li class="nav-item">
								    	<a class="nav-link" data-toggle="tab" href="#menu3">Mô tả</a>
								    </li>
								</ul>
							</div>
							<form  method="post" name="frmPro" id="frmPro"	enctype="multipart/form-data">
							  	<div class="tab-content">
								    <div id="home" class="tab-pane fade in active">
								      	
										<div class="col-md-12">

											<div class="form-group">
												<label>Vui lòng chọn danh mục của sản phẩm: <span class="help-block">*</span>:
												</label> 
												<input type="text"  ng-model="product.categorys.name" class="form-control"   id="categorys" readonly="true">
											</div>
											<div class="navigation-border" style="padding:0;z-index: 10002;display: block" > 
							                    <ul class="navigation-wrapper" id="myDropdown" >
							                        <li class="menuItem"  ng-repeat="category in listcategories" >
							                        	<a  class="linkItem">
							                        		 {{category.name}}
							                        	</a>
								                        <div class="submenu">
									                        <ul>
									                            <li class="submenu-NavSub" ng-repeat="subcategory in category.categories" ng-click="chooseCategory(subcategory.id,subcategory.name)">
									                            	{{subcategory.name}}
									                            </li>
									                        </ul>
									                    </div>                       
							                        </li>
							                       	
							                    </ul>
							                </div>
										</div>
								    </div>
								    <div id="menu1" class="tab-pane fade">
								      	<div class="col-md-6">
											<div class="form-group">
												<label>Tên sản phẩm <span class="help-block">*</span>:
												</label> <input type="text" ng-model="product.name" 
													ng-required="true" class="form-control" id="name-product">
												<span id="helpBlock2" class="help-block"
													ng-show="frmPro.name.$touched && frmPro.name.$error.required">Vui
													lòng nhập tên sản phẩm</span>
											</div>
											<div class="form-group">
												<label>Số lượng <span class="help-block">*</span>:
												</label> 
												<input type="number" ng-model="product.quantity"
													class="form-control" id="quantity"  min="1">
											</div>
											<div class="form-group">
												<label>Xuất xứ <span class="help-block">*</span>:
												</label> 
												<select id="origin" ng-model="product.origins.id" class=" form-control"  data-live-search="true">
												  <option ng-repeat="origins in listorigins" ng-value="origins.id"  data-tokens="{{origins.name}}">{{origins.name}}</option>
												  
												</select>	
											</div>
											
										</div>

										<div class="col-md-6">
											<div class="form-group">
												<label>Nhà sản xuất <span class="help-block">*</span>:</label> 
												<select class="form-control" id="producer" 
													ng-model="product.producers.id">
													<option ng-repeat="producer in listproducers" ng-value="producer.id">{{producer.name}}</option>
												</select>
											</div>
											<div class="form-group">
												<label>Vật liệu <span class="help-block">*</span>:
												</label> <select class="form-control" id="material" 
													ng-model="product.materials.id" >
													<option ng-repeat="material in listmaterials" ng-value="material.id">{{material.name}}</option>
												</select>
											</div>
											<div class="form-group">
												<label>Màu sắc: <span class="help-block">*</span>:
												</label> 
												<select ng-model="colors" id="colors" name="colors" class="selectpicker form-control" multiple  data-live-search="true">
												  <option ng-repeat="color in listcolor" id="check_{{color.id}}" value="{{color.id}}"  data-tokens="{{color.name}}">{{color.name}}</option>
												  
												</select>	
											</div>
											
									
										</div>
								    </div>
								    <div id="menu4" class="tab-pane fade">
										<div class="row">
											<div class="col-md-6">
												<div class="form-group">
													<label>Giá gốc<span class="help-block">*</span>:</label> 
													<input type="number" ng-change="changePrice()" ng-model="priceRoot.price"
														class="form-control" id="price" >
												</div>
											</div>
										</div>


										<p style="color:blue" ng-click="themDongia()">Thêm giá mới</p>
								     	<div class="row" ng-show="showInputPrice">
								     		<div class="col-2">
									     		<div class="form-group">
													<label>Giá bán<span class="help-block">*</span>:
													</label> <input type="number" ng-model="unitPrice.price"
														class="form-control" id="price_new"  min="1">
												</div>
									     	</div>
									     	<div class="col-5">
									     		<div class="form-group">
													<label>Thời gian bắt đầu</label> <input type="datetime-local" 
														class="form-control" id="txtstarttime" name="txtstarttime"
														ng-model="unitPrice.start_time" />
												</div>
									     	</div>
									     	<div class="col-5">
												<div class="form-group">
													<label>Thời gian kết thúc</label> <input type="datetime-local"
														class="form-control" id="txtendtime" name="txtendtime"
														ng-model="unitPrice.end_time"  />
												</div>
									     	</div>
								     	</div>
								      	<table ng-if="product.id != null" class="table table-striped table-bordered text-center">
											<thead>
												<tr>
													<th>STT</th>
													<th>Giá</th>
													<th>Ngày bắt đầu</th>
													<th>Ngày áp dụng</th>
												</tr>
											</thead>
											<tbody>
												
												<tr ng-repeat="price in Prices">
													<td>{{$index + 1}}</td>
													<td>{{price.price| currency: "":0}} đ</td>
													<td>{{price.start_time| date: "dd-MM-yyyy 'giờ' h:mma ":'UTC' }}</td>
													<td>{{price.end_time| date: "dd-MM-yyyy 'giờ' h:mma ":'UTC' }}</td>
													
												</tr>

											</tbody>
										</table>
								    </div>
								    <div id="menu2" class="tab-pane fade">
								      	<div class="row">
								      		<div class="col-md-8">
												<div class="form-group">
													<label>Ảnh đại diện <span class="help-block">*</span>:
													</label> <input type="file" ng-model="product.avatar"
														class="form-control" name="avatar" id="avatar">
												</div>
											</div>
											<div class="col-md-4">
												<img src="/img/uploads/{{product.avatar}}" alt="" id="image">
											</div>
								      	</div>
								      
								    </div>
								    <div id="menu3" class="tab-pane fade">
							      		<div class="col-md-12">
										<div class="form-group">
											<label>Mô tả sản phẩm <span class="help-block">*</span>:</label>
											<textarea ng-model="product.description" class="form-control" name="description" id="description" ckeditor="editorOptions">
								    		</textarea>
										</div>
										</div>
								    	<div class="modal-footer">
											<button class="btn btn-primary" type="submit"  ng-if="product.status == 0" ng-disabled="frmPro.$invalid"  ng-click="save()">Submit</button>
										</div>

								    </div>

								</div>
							</form>
						</div>

						<!-- Modal footer -->
						
					</div>
				</div>

			</div>
			<!-- .Modal Add and Edit Product -->

			<!--Modal cập nhật hình ảnh chi tiết sản Phẩm-->


			<div class="modal fade" tabindex="-1" role="dialog" id="modalImg">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">

							<h4 class="modal-title">{{ frmTitle }}</h4>
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">

							<div class="col-md-12 card">
						  		<h5>Ảnh chi tiết sản phẩm</h5>
						  		<br>
					  			<form method="post"  id="frmEditImg" class="form-horizontal" enctype="multipart/form-data">
					  				<meta name="csrf-token" content="{{ csrf_token() }}">
						  			<div class="row-image" ng-if="listImage.length > 0" >
								    	<div class="column-image hover-shadow" ng-repeat="img in listImage" >
								      		<img ng-src="/img/uploads/{{img.path}}" alt="Image">
								      		<div style="text-align: center; padding: 10px 0">
								      			<div class="input-group mb-3">
												    <div class="input-group-prepend">
												      <span class="input-group-text">STT</span>
												    </div>
												    <input type="number" name="stt[]" max="14" min="0" id="status_{{img.id}}" class="form-control" ng-value="img.status">
												</div>
												<div class="form-check">
													<label class="form-check-label">
														<input  type="checkbox" class="form-check-input" name="deleteImg[]" id="check_{{img.id}}" value="{{img.id}}">Xóa
													</label>
												</div>
								      			
								      		</div>
								      		
								    	</div>
									</div>
									<div style="float: right; padding:10px " ng-if="listImage.length > 0">
										<button type="button" ng-click="updateSTT()" class="btn btn-success" ><i class="fa fa-dot-circle-o"></i> Cập nhật</button>
						    			<button type="submit" class="btn btn-danger" ><i class="fa fa-trash-o"></i> Xóa ảnh</button>
						    		</div>
					    		</form>
					  		</div>	
						  	
								<form  method="post" name="frmImg" id="frmImg"	enctype="multipart/form-data" >
									<meta name="csrf-token" content="{{ csrf_token() }}">
									<div class="col-md-12">
										<div class="form-group">
								            <div class="file-loading">
								                <!-- <label>Preview File Icon</label> -->
								                <input id="imgs" name="imgs" type="file" multiple accept='image/jpeg , image/jpg, image/gif, image/png'>
								            </div>
								        </div>
								        <button type="submit" class="btn btn-success" style="float: right;"><i class="fa fa-dot-circle-o"></i> Thêm ảnh mới</button>
									</div>
									
								</form>	
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->

		</div>
		<!-- .content -->

	</section>
</body>

<section layout:fragment="script">
    <script th:src="@{/js/angularjs/controller/ProductController.js}"></script>
    <script th:src="@{/js/piexif.js}"></script>
    <script th:src="@{/js/sortable.js}"></script>
    <script th:src="@{/js/fileinput.js}"></script>

    <script th:src="@{/js/themes/fa/theme.js}"></script>
    <script th:src="@{/js/themes/explorer-fa/theme.js}"></script>
    <script>
    	jQuery("#imgs").fileinput({
        theme: 'fa',
        showUpload: false,
        showCaption: false,
        browseClass: "btn btn-primary",
        allowedFileExtensions: ['jpg', 'png', 'gif'],
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
        overwriteInitial: false,
        initialPreviewAsData: true
    });

    </script>
</section>
</html>
 





